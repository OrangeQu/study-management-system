<template>
  <div class="grade-filter">
    <div class="filter-row">
      <!-- å­¦æœŸç­›é€?-->
      <div class="filter-group">
        <span class="filter-label">å­¦æœŸ:</span>
        <el-select 
          v-model="filters.semester" 
          placeholder="é€‰æ‹©å­¦æœŸ" 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option
            v-for="semester in semesterOptions"
            :key="semester"
            :label="semester"
            :value="semester"
          />
        </el-select>
      </div>
      
      <!-- å­¦å¹´ç­›é€?-->
      <div class="filter-group">
        <span class="filter-label">å­¦å¹´:</span>
        <el-select 
          v-model="filters.academicYear" 
          placeholder="é€‰æ‹©å­¦å¹´" 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option
            v-for="year in academicYearOptions"
            :key="year"
            :label="year"
            :value="year"
          />
        </el-select>
      </div>
      
      <!-- çŠ¶æ€ç­›é€?-->
      <div class="filter-group">
        <span class="filter-label">çŠ¶æ€?</span>
        <el-select 
          v-model="filters.status" 
          placeholder="é€‰æ‹©çŠ¶æ€? 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option label="å…¨éƒ¨" value="" />
          <el-option label="å·²é€šè¿‡" value="passed" />
          <el-option label="æœªé€šè¿‡" value="failed" />
        </el-select>
      </div>
      
      <!-- è¯¾ç¨‹ç±»å‹ -->
      <div class="filter-group">
        <span class="filter-label">ç±»å‹:</span>
        <el-select 
          v-model="filters.courseType" 
          placeholder="è¯¾ç¨‹ç±»å‹" 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option label="å…¨éƒ¨" value="" />
          <el-option label="å¿…ä¿®è¯? value="required" />
          <el-option label="é€‰ä¿®è¯? value="elective" />
          <el-option label="é€šè¯†è¯? value="general" />
        </el-select>
      </div>
    </div>
    
    <div class="filter-row">
      <!-- å­¦åˆ†èŒƒå›´ -->
      <div class="filter-group">
        <span class="filter-label">å­¦åˆ†:</span>
        <el-select 
          v-model="filters.creditRange" 
          placeholder="å­¦åˆ†èŒƒå›´" 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option label="å…¨éƒ¨" value="" />
          <el-option label="0-2å­¦åˆ†" value="0-2" />
          <el-option label="2-4å­¦åˆ†" value="2-4" />
          <el-option label="4å­¦åˆ†ä»¥ä¸Š" value="4+" />
        </el-select>
      </div>
      
      <!-- æˆç»©èŒƒå›´ -->
      <div class="filter-group">
        <span class="filter-label">æˆç»©:</span>
        <el-select 
          v-model="filters.scoreRange" 
          placeholder="æˆç»©èŒƒå›´" 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option label="å…¨éƒ¨" value="" />
          <el-option label="90åˆ†ä»¥ä¸? value="90-100" />
          <el-option label="80-89åˆ? value="80-89" />
          <el-option label="70-79åˆ? value="70-79" />
          <el-option label="60-69åˆ? value="60-69" />
          <el-option label="60åˆ†ä»¥ä¸? value="0-59" />
        </el-select>
      </div>
      
      <!-- ç»©ç‚¹èŒƒå›´ -->
      <div class="filter-group">
        <span class="filter-label">ç»©ç‚¹:</span>
        <el-select 
          v-model="filters.gpaRange" 
          placeholder="ç»©ç‚¹èŒƒå›´" 
          clearable
          size="small"
          @change="handleFilterChange"
        >
          <el-option label="å…¨éƒ¨" value="" />
          <el-option label="3.5-4.0" value="3.5-4.0" />
          <el-option label="3.0-3.4" value="3.0-3.4" />
          <el-option label="2.5-2.9" value="2.5-2.9" />
          <el-option label="2.0-2.4" value="2.0-2.4" />
          <el-option label="2.0ä»¥ä¸‹" value="0-1.9" />
        </el-select>
      </div>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <div class="filter-actions">
        <el-button 
          type="text" 
          size="small" 
          @click="resetFilters"
          :icon="Refresh"
        >
          é‡ç½®
        </el-button>
        <el-button 
          type="primary" 
          size="small" 
          @click="handleFilterChange"
          :icon="Search"
        >
          ç­›é€?
        </el-button>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, computed } from 'vue'
import { Search, Refresh } from '@element-plus/icons-vue'

const props = defineProps({
  // é€‰é¡¹æ•°æ®
  semesters: {
    type: Array,
    default: () => []
  },
  academicYears: {
    type: Array,
    default: () => []
  },
  // åˆå§‹ç­›é€‰å€?
  initialFilters: {
    type: Object,
    default: () => ({})
  }
})

const emit = defineEmits(['filter-change'])

// ç­›é€‰æ¡ä»?
const filters = ref({
  semester: '',
  academicYear: '',
  status: '',
  courseType: '',
  creditRange: '',
  scoreRange: '',
  gpaRange: '',
  ...props.initialFilters
})

// è®¡ç®—é€‰é¡¹
const semesterOptions = computed(() => {
  return [...new Set(props.semesters)].sort().reverse()
})

const academicYearOptions = computed(() => {
  return [...new Set(props.academicYears)].sort().reverse()
})

// æ–¹æ³•
const handleFilterChange = () => {
  emit('filter-change', filters.value)
}

const resetFilters = () => {
  filters.value = {
    semester: '',
    academicYear: '',
    status: '',
    courseType: '',
    creditRange: '',
    scoreRange: '',
    gpaRange: ''
  }
  emit('filter-change', filters.value)
}

// ç›‘å¬åˆå§‹å€¼å˜åŒ?
watch(() => props.initialFilters, (newFilters) => {
  filters.value = { ...filters.value, ...newFilters }
}, { deep: true })

// æš´éœ²æ–¹æ³•
defineExpose({
  getFilters: () => filters.value,
  resetFilters
})
</script>

<style scoped>
.grade-filter {
  background: #f8f9fa;
  border-radius: 6px;
  padding: 15px;
  margin-bottom: 20px;
}

.filter-row {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 10px;
}

.filter-row:last-child {
  margin-bottom: 0;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-label {
  font-size: 13px;
  color: #666;
  white-space: nowrap;
}

.filter-actions {
  margin-left: auto;
  display: flex;
  gap: 8px;
  align-items: center;
}

/* å“åº”å¼è®¾è®?*/
@media (max-width: 992px) {
  .filter-row {
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .filter-group {
    flex: 1;
    min-width: 150px;
  }
}
</style>
